<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js - The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">
        <link href="/css/custom/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                <section>
                    <h1>RabbitMQ</h1>
                    <img src="images/RabbitMQ.png" width="300" />
                </section>

                <section>
                    <h2>Un broker di messaggistica</h2>
                </section>

                <section>
                    <img src="images/erlang.png" />
                    <h2>Scritto in erlang</h2>
                    <h4 class="fragment roll-in">sistemi real-time high availability</h4>
                    <h4 class="fragment roll-in">telecoms, banking, e-commerce, computer telephony e instant messaging</h4>
                    <h4 class="fragment roll-in">supporto nativo per concorrenzialità, distribuzione e fault tolerance</h4>
                </section>

                <section>
                    <img src="images/Pivotal_Logo.png" />
                    <h2>Mantenuto da pivotal</h2>
                    <div class="fragment roll-in">
                        <h4>Redis</h4>
                        <h4>Spring framework</h4>
                        <h4>Hadoop</h4>
                    </div>
                </section>

                <section>
                    <h2>usato da</h2>
                        <h5>indeed.com</h5>
                        <h5>telefonica</h5>
                        <h5>mozilla</h5>
                        <h5>instagram</h5>
                </section>

                <section>
                    <h2>Come installare RabbitMQ?</h2>
                    <br />
                    <div class="fragment"><h3>linux / debian</h3>apt-get install rabbitmq-server</div>
                    <br />
                    <div class="fragment"><h3>osx</h3>brew install rabbitmq</div>
                </section>

                <section>
                    <img src="images/too-easy.jpg" />
                </section>

                <section>
                    <h2>Windows?</h2>
                    <p class="fragment">there is an exe for that...</p>
                </section>

                <section>
                    <h1>Perchè Rabbit?</h1>
                    <br />
                    <h6 class="fragment roll-in">è open source (MPL)</h6>
                    <h6 class="fragment roll-in">supporta il protocollo AMQP</h6>
                    <h6 class="fragment roll-in">è scalabile</h6>
                </section>

                <section>
                    <h2>bindings per molti linguaggi</h2>
                    <br />
                    <div class="fragment roll-in">
                        <h6>php (amqplib-php)</h6>
                        <h6>ruby (bunny)</h6>
                        <h6>java (rabbitmq-java-client)</h6>
                        <h6>C#</h6>
                        <h6>perl</h6>
                        <h6>erlang</h6>
                        <h6>clojure</h6>
                        <h6 class="fragment roll-in">COBOL!</h6>
                    </div>
                </section>

                <section>
                    <h3>Perchè Rabbit?</h3>
                    <h1>performance</h1>

                    <p>Nokia Real Time Traffic Maps</p>
                    <p>800.000 messaggi / minuto</p>
                </section>

                <section>
                    <h4>Perchè Rabbit?</h4>
                    <h1>realtime is the new loud</h1>
                    <p>api di instagram</p>
                </section>

                <section>
                    <h4>Perchè Rabbit?</h4>
                    <h1>scalability is the new loud</h1>
                    <p>aws</p>
                </section>

                <section>
                    <h4>Perchè Rabbit?</h4>
                    <h1>multi-language is the new loud</h1>
                    <p>php, python, ruby, node anyone?</p>
                </section>


                <section>
                    <h1>AMQP</h1>
                    <h5>Advanced Message Queuing Protocol</h5>
                </section>

                <section>
                    <p>Un layer applicativo standard aperto per middleware orientati ai messaggi</p>
                    <p>creato nel 2004 da John O'Hara (JPMorgan Chase)</p>
                    <p>in seguito adottatto come standard aperto da cisco, red hat, novell, microsoft, vmware</p>
                </section>

                <section>
                    <p>RabbitMQ implementa il protocollo AMQP nativamente</p>
                    <p>Altri protocolli come stomp, MQTT e http sono installabili via plugin</p>
                    <br />
                    <p>AMQP è la scelta più facile e migliore</p>
                </section>

                <section>
                    <h1>Back to the rabbit</h1>
                    <img src="images/ravingrabbids.jpg" height="400">
                </section>

                <section>
                    <h2>come funzionano i messaggi?</h2>
                </section>

                <section>
                    <p>a day in the life of a message</p>
                    <img src="images/message-flow.png" />
                </section>

                <section>
                    <img src="images/hello-world-example-routing.png" />
                </section>

                <section>
                    <h1>rabbit (amqp) è:</h1>
                </section>

                <section>
                    <h1>Messaggi</h1>
                    <p>Un messaggio non è altro che IL dato</p>
                    <p>è composto da un body e da un payload</p>
                    <br />
                    <p>alcuni headers utilizzati per convenzione</p>
                    <ul class="fragment">
                        <li>Content type</li>
                        <li>Content encoding</li>
                        <li>Routing key</li>
                        <li>Delivery mode (persistent or not)</li>
                        <li>Message priority</li>
                        <li>Message publishing timestamp</li>
                        <li>Expiration period</li>
                        <li>Publisher application id</li>
                    </ul>
                </section>

                <section>
                    <h1>producer</h1>
                    <br />
                    <h1>consumer</h1>
                </section>

                <section>
                    <h1>Exchange</h1>
                    <p>Business logic dell'applicazione</p>
                    <p>Riceve i messaggi e li smista</p>
                </section>

                <section>
                    <h1>Queue</h1>
                    <br />
                    <p>coda di messaggi in attesa di essere gestiti da un consumer</p>
                    <p>in un certo senso un consumer <strong>è</strong> una coda</p>
                </section>

                <section>
                    <h1>Virtual Host</h1>
                    <p>1 rabbit = tanti rabbit</p>
                    <p>ambiente completamente isolato dove vivono le entità AMQP</p>
                    <p>non è programmabile</p>
                </section>

                <section>
                    <p>show me the code...</p>
                    <img src="images/i-have-no-idea-what-im-doing-dog.jpg" />
                </section>

                <section>
                    <h2>composer.json</h2>
                    <pre>
                        <code data-trim>
{
    "require": {
        "videlalvaro/php-amqplib": "~2.2.6"
    }
}
                        </code>
                    </pre>
                </section>

                <section>
                    <pre>
                        <code data-trim>
use PhpAmqpLib\Connection\AMQPConnection;
use PhpAmqpLib\Message\AMQPMessage;

$connection = new AMQPConnection('localhost', 5672, 'guest', 'guest');
$channel = $connection->channel();

// codice

$channel->close();
$connection->close();
                        </code>
                    </pre>
                </section>

                <section>
                    <pre>
                        <code data-trim>
// dichiaro una coda
$channel->queue_declare('hello');
// creo un messaggio
$msg = new AMQPMessage('Hello World!');
// pubblico
$channel->basic_publish($msg, '', 'hello');
                        </code>
                    </pre>
                    <pre>
                        <code data-trim>
/**
 * declare queue, create if needed
 */
public function queue_declare($queue="", $passive=false, $durable=false,
                               $exclusive=false, $auto_delete=true,
                               $nowait=false, $arguments=null, $ticket=null) {}
/**
 * publish a message
 */
public function basic_publish($msg, $exchange="", $routing_key="",
                                  $mandatory=false, $immediate=false,
                                  $ticket=null) {}
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>3 modelli principali di routing</h2>
                    <br />
                    <h3 class="fragment roll-in">direct</h3>
                    <h3 class="fragment roll-in">fanout</h3>
                    <h3 class="fragment roll-in">topic</h3>
                </section>

                <section>
                    <h2>direct exchange</h2>
                    <img src="images/direct.png" height="100" />
                </section>

                <section>
                    <h2>use cases</h2>
                    <br />
                    <h3 class="fragment roll-in">test</h3>
                    <h3 class="fragment roll-in">piccoli setup (request offload)</h3>
                </section>

                <section>
                    <h2>producer</h2>
                    <pre>
                        <code data-trim>
// dichiaro una coda
$channel->queue_declare('hello', false, false, false, false);

// creo un messaggio
$msg = new AMQPMessage('Hello World!');

// pubblico
$channel->basic_publish($msg, '', 'hello');

/** API REFERENCE **/
// declare queue, create if needed
public function queue_declare($queue="", $passive=false, $durable=false,
                               $exclusive=false, $auto_delete=true,
                               $nowait=false, $arguments=null, $ticket=null) {}
// publish a message
public function basic_publish($msg, $exchange="", $routing_key="",
                                  $mandatory=false, $immediate=false,
                                  $ticket=null) {}
                        </code>
                    </pre>
                    <!--<h4>nome coda: stringa vuota</h4>
                    <h4>routing key: nome della coda</h4>-->
                </section>

                <section>
                    <h2>consumer</h2>
                    <pre>
                        <code data-trim>
// dichiaro una coda identica a quella di prima
$channel->queue_declare('hello', false, false, false, false);

$callback = function($msg) {
  echo " [x] Received ", $msg->body, "\n";
};

$channel->basic_consume('hello', '', false, true, false, false, $callback);

while(count($channel->callbacks)) {
    $channel->wait();
}

/** API REFERENCE **/
// start a queue consumer
public function basic_consume($queue="", $consumer_tag="", $no_local=false,
                              $no_ack=false, $exclusive=false, $nowait=false,
                              $callback=null, ...)
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>fanout</h2>
                    <img src="images/fanout.png" height="250" />
                </section>

                <section>
                    <h2>use cases</h2>
                    <br />
                    <h3 class="fragment roll-in">logging</h3>
                    <h3 class="fragment roll-in">dashboards in tempo reale</h3>
                    <h3 class="fragment roll-in">pub/sub</h3>
                </section>

                <section>
                    <h2>fanout setup</h2>
                    <pre>
                        <code data-trim>
// prima avevamo un exchange senza nome e una routing key
$channel->basic_publish($msg, '', 'hello');

// creo un exchange
$channel->exchange_declare('logs', 'fanout', false, false, false);

// publico
$channel->basic_publish($msg, 'logs');

/** API REFERENCE **/
// declare exchange, create if needed
public function exchange_declare($exchange, $type, $passive=false,
                            $durable=false, $auto_delete=true, ...)
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>Code temporanee</h2>
                    <p>il nome della coda è importante quando vuoi condividere l'informazione tra producer e consumer</p>
                    <p>questo non è il caso</p>
                    <pre>
                        <code data-trim>
list($queue_name, ,) = $channel->queue_declare("");
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>bindings</h2>
                    <img src="images/bindings.png" height="150" />
                    <pre>
                        <code data-trim>
$channel->queue_bind($queue_name, 'logs');
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>log_receiver.php</h2>
                    <pre>
                        <code data-trim>
$channel->exchange_declare('logs', 'fanout', false, false, false);

list($queue_name, ,) = $channel->queue_declare("", false, false, true, false);

$channel->queue_bind($queue_name, 'logs');

echo ' [*] Waiting for logs. To exit press CTRL+C', "\n";

$callback = function($msg){
  echo ' [x] ', $msg->body, "\n";
};

$channel->basic_consume($queue_name, '', false, true, false, false, $callback);

while(count($channel->callbacks)) {
    $channel->wait();
}

$channel->close();
$connection->close(); // la coda viene cancellata
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>topic</h2>
                    <img src="images/topic.png" height="250">
                    <p>uno dei modelli più complessi</p>
                    <p>ideale per sistemi che fanno largo uso di messaggi</p>
                </section>

                <section>
                    <h2>topic producer</h2>
                    <pre>
                        <code data-trim>
// creo un exchange
$channel->exchange_declare('topic_logs', 'topic', false, false, false);

// publico
$msg = new AMQPMessage('test');
$channel->basic_publish($msg, 'topic_logs', 'server1.alert');
$channel->basic_publish($msg, 'topic_logs', 'server1.debug');
$channel->basic_publish($msg, 'topic_logs', 'server2.alert');
                        </code>
                    </pre>
                    <h2>topic consumer</h2>
                    <pre>
                        <code data-trim>
// creo un exchange uguale al precedente
$channel->exchange_declare("topic_logs", "topic", false, false, false);

list($server1Queue, ,) = $channel->queue_declare("", false, false, true, false);
$channel->queue_bind($server1Queue, 'topic_logs', 'server1.#');

list($alertQueue, ,) = $channel->queue_declare("", false, false, true, false);
$channel->queue_bind($alertQueue, 'topic_logs', '#.alert');
                        </code>
                    </pre>
                </section>

                <section>
                    <h2>routing wildcards</h2>
                    <br />
                    <h3>*</h3>
                    <p>esattamente una parola</p>
                    <h3>#</h3>
                    <p>zero o più parole</p>
                </section>

                <section>
                    <h2>Message Acknowledgements (acks)</h2>
                    <p>riduce le performance, ma è fondamentale per i messaggi importanti</p>
                </section>

                <section>
                    <h3>cose da fare dopo aver installato rabbit</h3>
                </section>
                <section>
                    <h2>abilitare il management plugin</h2>
                    <pre>
                        <code data-trim>
                            rabbitmq-plugins enable rabbitmq_management
                        </code>
                    </pre>
                    <h4>http://localhost:15672/</h4>
                    <img class="fragment roll-in" src="images/rabbit-management.png" />
                </section>
                <section>
                    <h3>RabbitMQSimulator</h3>
                    <h4>RabbitMQSimulator / RabbitMQSimulator</h4>
                </section>

                <section>
                    <h2>Cose che avrei voluto sapere prima di cominciare ad usare rabbit</h2>
                </section>

                <section>
                    <h6>aka</h6>
                    <br />
                    <div class="fragment">
                        <h2>wtf moment</h2>
                        <img src="images/omg_wtf.gif" height="180" />
                    </div>
                </section>

                <section>
                    <h2>Un messaggio non viene MAI messo direttamente in una coda</h2>
                    <p>questo romperebbe il principio secondo il quale il producer non sa se e quali consumer sono in ascolto</p>
                </section>

                <section>
                    <h2>AMQP è un protocollo programmabile</h2>
                    <p>la logica sta nell'applicazione, non nel server</p>
                </section>

                <section>
                    <h2>non effettuare MAI il routing nei consumer</h2>
                </section>

                <section>
                    <h2>fair dispatch</h2>
                    <p>i messaggi vengono assegnati immediatamente...appena arrivano</p>
                    <p>Non rimangono in attesa nell'exchanger</p>
                </section>

                <section>
                    <h2>Symfony</h2>
                    <h4 class="fragment roll-in">videlalvaro / RabbitMqBundle</h4>
                </section>

                <section>
                    <pre>
                        <code data-trim>
old_sound_rabbit_mq:
    connections:
        default:
            host:     %rabbit_host%
            lazy:     true
            port:     5672
            user:     %rabbit_user%
            password: %rabbit_password%
            vhost:    %rabbit_vhost%
                        </code>
                    </pre>
                </section>
                <section>
                    <pre><code>    producers:
        entity:
            connection: default
            exchange_options:
                name: entity
                type: topic</code></pre>
                    <pre>
                        <code>    consumers:
        pdf_splitter:
            connection: default
            exchange_options: { name: entity, type: topic }
            queue_options:
                name: pdf_split
                routing_keys:
                    - document_upload.created
            qos_options: { prefetch_size: 0, prefetch_count: 1, global: false }
            callback: vendor.rabbitmq.consumer.document.pdf_splitter

        page_previewer:
            connection: default
            exchange_options: { name: entity, type: topic }
            queue_options:
                name: page_preview
                routing_keys:
                    - document_page.created
            qos_options: { prefetch_size: 0, prefetch_count: 1, global: false }
            callback: vendor.rabbitmq.consumer.document.page_previewer</code>
                    </pre>
                </section>

                <section>
                    <h1>use case</h1>
                </section>

                <section>
                    <img src="images/backoffice_documenti.png" />
                </section>

                <section>
                    <h1>grazie!</h1>
                    <br />
                    <h3><img src="images/github.png" width="50" style="border: none; vertical-align: middle" /> matteosister</h3>
                    <h3><img src="images/GitElephant-logo.png" width="50" style="border: none; vertical-align: middle" /> GitElephant</h3>
                    <img src="images/thanks.gif" />
                    <img src="images/thank-you.gif" />
                </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
